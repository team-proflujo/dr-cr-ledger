<html>
    <head>
        <title>Practice Debit Credit Ledger</title>

        <meta name="description" content="Practice Debit Credit Ledger is a web application designed to help users understand and practice the process of maintaining debit and credit ledgers. It provides an interactive platform for users to learn how to record transactions in their ledgers, identify discrepancies, and ensure accurate financial records.">

        <meta name="keywords" content="Debit Credit Ledger, Practice Debit Credit Ledger, Ledger Maintenance, Financial Records, Discrepancies, Interactive Learning">

        <meta name="author" content="Proflujo Technology Pvt. Ltd.">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="icon" type="image/svg+xml" href="assets/images/logo.svg">

        <style type="text/css">
            @font-face {
                font-family: 'AppFont';
                src: url('assets/fonts/ubuntu-regular.ttf') format('truetype');
                font-weight: normal;
                font-style: normal;
            }

            html, body, #app {
                margin: 0;
                padding: 0;
                width: 100%;
                height: 100%;
                font-family: AppFont;
                font-size: 1.1em;
                user-select: none;
            }

            body {
                position: relative;
            }

            .flex-right {
                display: flex;
                justify-content: flex-end;
            }

            #mode-select {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                width: 100%;
                height: 100%;
            }

            #mode-select > #mode-select-options {
                display: flex;
                align-items: center;
                justify-content: center;
            }

            #mode-select button:not(:first-child) {
                margin-left: 2rem;
            }

            #wb {
                display: flex;
                flex-direction: column;
                align-items: center;
                /* justify-content: center; */
                width: 100%;
                min-height: 100%;
                height: auto;
            }

            svg {
                width: 1em;
                height: 1em;
            }

            select {
                font-size: inherit;
            }

            .table-container {
                width: 90%;
                overflow-x: auto;
            }

            table {
                border-collapse: collapse;
                margin: auto;
                table-layout: fixed;
            }

            th, td {
                border: 1px solid #ddd;
                padding: 0.5em;
            }

            tr:nth-child(even) {
                background-color: #f2f2f2;
            }

            tr:hover {
                background-color: #ddd;
            }

            th {
                padding-top: 0.75em;
                padding-bottom: 0.75em;
                text-align: left;
                background-color: #007BFF;
                color: white;
            }

            #dr-cr-table {
                width: 100%;
                min-width: 700px;
            }

            #dr-cr-table input,
            #dr-cr-table select,
            #dr-cr-table textarea {
                width: 100%;
            }

            #dr-cr-table > thead > tr > th:first-child,
            #dr-cr-table > tbody > tr > td:first-child {
                width: 20%;
            }

            #dr-cr-table > thead > tr > th.dd-cell,
            #dr-cr-table > tbody > tr > td.dd-cell {
                width: 10%;
            }

            #dr-cr-table > thead > tr > th:last-child,
            #dr-cr-table > tbody > tr > td:last-child {
                width: 5%;
                text-align: center;
            }

            #dr-cr-table > thead > tr > th.amount-cell,
            #dr-cr-table > tbody > tr > td.amount-cell {
                width: 10%;
                text-align: center;
            }

            /* #dr-cr-table > thead > tr > th:nth-last-child(2),
            #dr-cr-table > tbody > tr > td:nth-last-child(2) {
                width: 20%;
            } */

            #dr-cr-table > tbody > tr:nth-child(even) {
                border-bottom: 2px solid #000;
            }

            .amount-cell,
            .amount-cell input {
                text-align: right;
            }

            .result-correct td:not(.result),
            #dr-cr-table td:not(:last-child).result-correct {
                background-color: #ccffcc;
            }

            .result-wrong td:not(.result),
            #dr-cr-table td:not(:last-child).result-wrong {
                background-color: #ffcccc;
            }

            #dr-cr-table tbody.result-correct > tr > td.result,
            #dr-cr-table td:last-child.result-correct {
                color: green;
            }

            #dr-cr-table tbody.result-wrong > tr > td.result,
            #dr-cr-table td:last-child.result-wrong {
                color: red;
            }

            #dr-cr-table > tbody:not(:nth-child(2))::before {
                content: '';
                display: block;;
                height: 1rem;
                border: inherit;
            }

            button {
                padding: 0.5em 1em;
                font-family: inherit;
                font-size: 1em;
                color: white;
                background-color: #007BFF;
                border: none;
                border-radius: 0.25em;
                cursor: pointer;
            }

            button:has(svg) {
                display: flex;
                align-items: center;
            }

            button.success {
                background-color: #28a745;
            }

            button.btn-cancel {
                background-color: #6c757d;
            }

            .btn-card {
                display: flex;
                flex-direction: column;
                justify-content: center;
                align-items: center;
            }

            .btn-card > span {
                margin-top: 0.5em;
            }

            .btns-container {
                margin-top: 2rem;
                width: 100%;
                display: flex;
                justify-content: space-evenly;
                align-items: center;
            }

            h3 {
                text-align: center;
            }

            .btn-link {
                text-decoration: none;
                color: #007BFF !important;
            }

            .delete-row {
                color: #dc3545 !important;
            }

            button.gold {
                background: linear-gradient(45deg, #AE8625, #F7EF8A, #D2AC47, #EDC967);
                color: #000;
            }

            #golden-rule-table:not(.show) {
                display: none;
            }

            * *.hide {
                display: none !important;
            }

            @media screen and (max-width: 580px) {
                #mode-select > #mode-select-options {
                    flex-direction: column;
                }

                #mode-select button:not(:first-child) {
                    margin-left: 0;
                    margin-top: 1rem;
                }
            }
        </style>

        <script type="text/javascript" src="assets/js/jquery-4.0.0.min.js"></script>
    </head>
    <body>
        <div id="app">
            <div id="wb">
                <h3>Practice Debit Credit Ledger</h3>

                <!-- <div style="width: 90%; display: flex; justify-content: center; margin-bottom: 1rem;">
                    <button class="gold">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>&nbsp;The Golden rule
                    </button>
                </div> -->

                <div class="table-container" id="golden-rule-table" style="margin-bottom: 2rem;">
                    <table>
                        <thead>
                            <tr>
                                <th></th>
                                <th>Dr</th>
                                <th>Cr</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>Real</td>
                                <td>What comes in</td>
                                <td>What goes out</td>
                            </tr>
                            <tr>
                                <td>Personal</td>
                                <td>The receiver</td>
                                <td>The Giver</td>
                            </tr>
                            <tr>
                                <td>Nominal</td>
                                <td>Expenses/Losses</td>
                                <td>Income/Profit</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="table-container">
                    <table id="dr-cr-table">
                        <thead>
                            <tr>
                                <th>Description</th>
                                <th>Enter Entity</th>
                                <th class="dd-cell">Account Type</th>
                                <th class="dd-cell">Dr/Cr</th>
                                <th class="amount-cell">Amount</th>
                                <!-- <th></th> -->
                                <!-- <th class="amount-cell">Account Balance</th> -->
                                <th></th>
                            </tr>
                        </thead>
                        <!-- <tfoot>
                            <tr>
                                <th colspan="4" style="text-align: right;">Closing Balance</th>
                                <th class="amount-cell" id="closing-balance">0.00</th>
                                <th></th>
                            </tr>
                        </tfoot> -->
                    </table>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            (function() {
                const TX_TYPE_DEBIT = 'Debit',
                    TX_TYPE_CREDIT = 'Credit';

                const AccountTypes = Object.freeze({
                    real: 'Real',
                    personal: 'Personal',
                    nominal: 'Nominal',
                });

                const AccountEvents = Object.freeze([
                    {
                        'id': 1,
                        'description': 'Raman gave ₹100',
                        'drEntity': 'Cash',
                        'drAccountType': AccountTypes.real,
                        'drAmount': 100,
                        'crEntity': 'Raman',
                        'crAccountType': AccountTypes.personal,
                        'crAmount': 100,
                    },
                    {
                        'id': 2,
                        'description': 'Fuel Charges ₹500',
                        'drEntity': 'Fuel',
                        'drAccountType': AccountTypes.nominal,
                        'drAmount': 500,
                        'crEntity': 'Cash',
                        'crAccountType': AccountTypes.real,
                        'crAmount': 500,
                    },
                ]);

                let closingBalance = 0;

                function shuffleEvents() {
                    const shuffled = [...AccountEvents];

                    for (i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));

                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }

                    return shuffled;
                }

                function createSelect(options, className = '') {
                    let selectHTML = `<select class="${className}"><option value=""></option>`;
                    for (const key in options) {
                        selectHTML += `<option value="${options[key]}">${options[key]}</option>`;
                    }
                    selectHTML += `</select>`;
                    return selectHTML;
                }

                function renderTable() {
                    const table = $('#dr-cr-table');

                    table.find('tbody').empty();

                    const accountTypesDD = createSelect(AccountTypes, 'txt-account-type'),
                        txTypeDD = createSelect({
                            [TX_TYPE_DEBIT]: TX_TYPE_DEBIT,
                            [TX_TYPE_CREDIT]: TX_TYPE_CREDIT,
                        }, 'txt-tx-type');

                    for (const [index, event] of shuffleEvents().entries()) {
                        const tbody = $(`
                            <tbody event-id="${event.id}">
                                <tr event-id="${event.id}">
                                    <td rowspan="2">${event.description}</td>
                                    <td><input type="text" class="txt-entity" placeholder="e.g., Raman" /></td>
                                    <td class="dd-cell">${accountTypesDD}</td>
                                    <td class="dd-cell">${txTypeDD}</td>
                                    <td class="amount-cell"><input type="number" class="txt-amount" placeholder="e.g., 1000.50" /></td>
                                    <td rowspan="2" class="result"></td>
                                </tr>

                                <tr event-id="${event.id}">
                                    <td><input type="text" class="txt-entity" placeholder="e.g., Cash" /></td>
                                    <td class="dd-cell">${accountTypesDD}</td>
                                    <td class="dd-cell">${txTypeDD}</td>
                                    <td class="amount-cell"><input type="number" class="txt-amount" placeholder="e.g., 1000.50" /></td>
                                </tr>
                            </tbody>
                        `.trim());

                        table.append(tbody);
                    }
                }

                function isFormChanged() {
                    return $('#dr-cr-table select, #dr-cr-table input, #dr-cr-table textarea').filter(function () { return $(this).val(); }).length > 0;
                }

                function isStringExists(source, search) {
                    return source && search && source.replace(/\s/g, '').toLowerCase().includes(search.replace(/\s/g, '').toLowerCase());
                }

                $(document).on('change', '#dr-cr-table select, #dr-cr-table input, #dr-cr-table textarea', function() {
                    const tbody = $(this).closest('tbody');

                    const eventId = tbody.attr('event-id');
                    const event = AccountEvents.find(e => e.id == eventId);

                    let rowsData = [];

                    tbody.children('tr').each(function() {
                        const tr = $(this);
                        // console.log('tr:', tr);

                        const entity = tr.find('.txt-entity').val(),
                            accountType = tr.find('.txt-account-type').val(),
                            txType = tr.find('.txt-tx-type').val(),
                            amount = parseFloat(tr.find('.txt-amount').val());

                        rowsData.push({
                            entity,
                            accountType,
                            txType,
                            amount,
                        });
                    });

                    // console.log(rowsData);

                    let isCorrect = true, showError = false;

                    for (const [index, row] of rowsData.entries()) {
                        if (row.entity && row.accountType && row.txType) {
                            showError = true;

                            if (row.entity && rowsData.some((r, i) => i!=index && isStringExists(r.entity, row.entity))) {
                                isCorrect = false;
                            }

                            if (row.txType && rowsData.some((r, i) => i!=index && r.txType === row.txType)) {
                                isCorrect = false;
                            }

                            // console.log('isCorrect:', isCorrect, event, row);

                            if (!isCorrect) break;

                            /* console.log(
                                row.txType === TX_TYPE_DEBIT && isStringExists(event.drEntity, row.entity) && event.drAccountType === row.accountType && event.drAmount == row.amount,
                                row.txType === TX_TYPE_CREDIT && isStringExists(event.crEntity, row.entity) && event.crAccountType === row.accountType && event.crAmount == row.amount
                            ); */

                            isCorrect = (
                                row.txType === TX_TYPE_DEBIT && isStringExists(row.entity, event.drEntity) && event.drAccountType === row.accountType && event.drAmount == row.amount
                            ) || (
                                row.txType === TX_TYPE_CREDIT && isStringExists(row.entity, event.crEntity) && event.crAccountType === row.accountType && event.crAmount == row.amount
                            );
                        } else {
                            isCorrect = false;
                            showError = false;
                        }
                    }

                    if (showError) {
                        tbody.find('.result').text(isCorrect ? 'Correct' : 'Wrong');
                        tbody.removeClass('result-correct result-wrong').addClass(isCorrect ? 'result-correct' : 'result-wrong');
                    } else {
                        tbody.find('.result').text('');
                        tbody.removeClass('result-correct result-wrong');
                    }
                });

                $(document).ready(function() {
                    renderTable();
                });
            })();
        </script>
    </body>
</html>
